---
title: Validator Operations
description: Day-to-day operations for Tempo validators. Node lifecycle, upgrades, key rotation, monitoring, and troubleshooting.
---

# Validator Operations

This guide covers day-to-day operations for running a Tempo validator in production.

## Node Lifecycle

### Starting and Stopping

Use `SIGINT` (Ctrl+C) or `SIGTERM` to gracefully stop the node:

```bash
# If running directly
kill -INT <pid>

# If running via systemd
sudo systemctl stop tempo
```

The node will finish processing the current block before shutting down. Avoid using `SIGKILL` as it may corrupt the database.

### Restarting from Snapshot

Validators can safely restart from a snapshot if needed:

```bash
# Stop the node
sudo systemctl stop tempo

# Remove old data (keep your signing key!)
rm -rf <datadir>/db

# Download fresh snapshot
tempo download --datadir <datadir>

# Start the node
sudo systemctl start tempo
```

After restarting, your validator will rejoin the active set once it syncs to the chain tip and participates in the next DKG ceremony (up to 48-72 hours).

## Upgrades

### Finding the Latest Version

Check the latest release:

```bash
curl -s https://api.github.com/repos/tempoxyz/tempo/releases/latest | grep tag_name
```

The [changelog](/changelog) lists all releases and breaking changes.

### Upgrade Procedure

1. Download the new binary:
   ```bash
   curl -L https://github.com/tempoxyz/tempo/releases/download/<version>/tempo-<version>-<arch> -o tempo-new
   chmod +x tempo-new
   ```

2. Stop the node:
   ```bash
   sudo systemctl stop tempo
   ```

3. Replace the binary:
   ```bash
   sudo mv tempo-new /usr/local/bin/tempo
   ```

4. Start the node:
   ```bash
   sudo systemctl start tempo
   ```

### Hardfork Coordination

Before scheduled hardforks:
- Upgrade to the required version before the activation block
- Confirm your node is synced to the latest block height
- Monitor the #validators channel for coordination updates

## Key Management

### Signing Key Rotation

To rotate your validator's signing key:

1. Generate a new keypair:
   ```bash
   tempo consensus generate-private-key --output <new-key-path>
   tempo consensus calculate-public-key --private-key <new-key-path>
   ```

2. Contact the Tempo team to update your validator's public key on-chain

3. Once confirmed, update your node configuration to use the new key and restart

:::warning
The old validator identity must be deactivated before the new one is activated. Coordinate timing with the Tempo team.
:::

### Signing Share Recovery

If you lose your signing share (stored in `<datadir>/consensus/`), your validator will automatically receive a new share at the next DKG ceremony. This takes 48-72 hours depending on the epoch stage.

## Monitoring

### Key Metrics

Export metrics on port 8002 by default. Critical metrics to monitor:

| Metric | Description | Alert Threshold |
|--------|-------------|-----------------|
| `reth_sync_state` | Sync status (1 = synced) | != 1 for > 5 min |
| `reth_network_connected_peers` | Peer count | < 3 |
| `consensus_network_spawner_connections` | Consensus peer count | < 3 |
| `consensus_engine_dkg_manager_ceremony_successes_total` | DKG successes | 0 after 72 hours |
| `reth_blockchain_tree_block_height` | Current block height | Lagging explorer by > 100 |

### Checking Sync Status

```bash
# Compare local height to explorer
LOCAL=$(cast block-number --rpc-url http://localhost:8545)
REMOTE=$(cast block-number --rpc-url https://rpc.testnet.tempo.xyz)
echo "Local: $LOCAL, Remote: $REMOTE, Behind: $((REMOTE - LOCAL))"
```

### Checking Peer Connections

```bash
# Execution layer peers
curl -s localhost:8002/metrics | grep reth_network_connected_peers

# Consensus layer peers
curl -s localhost:8002/metrics | grep consensus_network_spawner_connections

# List connected peers via RPC
cast rpc admin_peers --rpc-url http://localhost:8545 | jq '.[].network.remoteAddress'
```

### Verifying Block Production

When your validator is proposing blocks, you'll see logs like:

```
INFO handle_propose{epoch=18 view=387213}: tempo_commonware_node::consensus::application::actor: constructed proposal
```

If you don't see these logs after 72 hours in the active set, check:

1. Your node is fully synced
2. Your IP matches the whitelisted address:
   ```bash
   cast call 0xCccCcCCC00000000000000000000000000000000 "getValidators()((bytes32, bool, uint64, address, string, string)[])" --rpc-url https://rpc.testnet.tempo.xyz --json | jq
   ```
3. DKG ceremony succeeded (see [validator setup](/guide/node/validator#checking-that-your-node-has-successfully-participated-in-a-dkg-ceremony))

## Log Management

### Parsing Logs

Tempo logs include ANSI escape codes for colors. To strip them for grep/awk:

```bash
# Strip colors when searching
sudo journalctl -u tempo | sed 's/\x1b\[[0-9;]*m//g' | grep "error"

# Or disable colors at runtime
RUST_LOG_STYLE=never tempo node ...
```

### Log Levels

Control verbosity with `RUST_LOG`:

```bash
# Default (info)
RUST_LOG=info

# Debug consensus only
RUST_LOG=info,tempo_commonware_node::consensus=debug

# Quiet mode (warnings and errors only)
RUST_LOG=warn
```

## Troubleshooting

### Node Stalled at Specific Height

If your node stops syncing at a specific block:

1. Check if other validators are also stuck (network issue vs local issue)
2. Check for errors in logs:
   ```bash
   sudo journalctl -u tempo -n 5000 | grep -i "error\|panic\|fatal"
   ```
3. Try restarting from snapshot if the issue persists

### Not Receiving Signing Share

If `consensus_engine_dkg_manager_ceremony_successes_total` stays at 0:

1. Verify your IP is whitelisted correctly
2. Check firewall allows inbound/outbound on port 30303
3. Confirm your node is synced and connected to consensus peers
4. Wait for the next DKG ceremony (runs every ~48 hours)

### IP Configuration

Your validator's outbound IP must match the whitelisted IP. If you have separate inbound/outbound IPs:

- Inbound IP: Used for `--discovery.addr`
- Outbound IP: Must match the IP registered on-chain

To check your outbound IP:

```bash
curl -s https://ifconfig.me
```

## Backup and Recovery

### What to Back Up

| Path | Contents | Recovery Impact |
|------|----------|-----------------|
| `<datadir>/consensus/signing_key` | ED25519 private key | Requires on-chain rotation if lost |
| `<datadir>/consensus/signing_share` | BLS share | Auto-recovers at next DKG (48-72h) |
| `<datadir>/db/` | Chain data | Re-download via snapshot |

### Disaster Recovery

If you lose everything:

1. Provision new infrastructure
2. Install tempo binary
3. Generate new signing key and coordinate on-chain update with Tempo team
4. Download snapshot and start node
5. Wait for DKG ceremony to receive signing share

Your validator will be offline for 48-72 hours during recovery.
