# `token_getRoleHistory`

## Overview

Gets paginated role change history for [TIP-20 tokens](/documentation/tokens) on Tempo.

Tracks role grants and revocations from the `RoleMembershipUpdated` event for audit trails and compliance monitoring.

Uses cursor-based pagination for stable iteration through role changes.

## Request

```ts
type Request = {
  method: 'token_getRoleHistory'
  params: [{
    /** 
     * Cursor for pagination (based on blockNumber:logIndex). 
     * 
     * Defaults to first entry based on the sort and filter configuration.
     * Use the `nextCursor` in response to get the next set of role changes.
     */
    cursor?: string
    /** Filter configuration. */
    filters?: {
      /** Filter by account address that received/lost role */
      account?: Address
      /** Block number in range */
      blockNumber?: [min: Hex | null, max: Hex | null]
      /** Filter by granted vs revoked (true = grants, false = revocations) */
      granted?: boolean
      /** Filter by specific role (32-byte hex) */
      role?: Hex
      /** Filter by address that made the change */
      sender?: Address
      /** Timestamp (seconds) in range */
      timestamp?: [min: number | null, max: number | null]
      /** Filter by token address */
      token?: Address
    }
    /** 
     * Maximum number of role changes to return.
     * 
     * Defaults to 10.
     * Maximum is 100.
     */
    limit?: number
    /** Sorting configuration */
    sort?: {
      /** Field to sort by (e.g., 'blockNumber', 'timestamp', 'account', 'role') */
      on: string
      /** Sort direction */
      order: 'asc' | 'desc'
    }
  }]
}
```

## Response

```ts
type Response = {
  /** Cursor for next page, null if no more results */
  nextCursor: string | null
  /** Array of role changes matching the query */
  roleChanges: RoleChange[]
}

type RoleChange = {
  /** Account that received/lost the role */
  account: Address
  /** Block number where change occurred */
  blockNumber: Hex
  /** Whether role was granted (true) or revoked (false) */
  granted: boolean
  /** Role identifier (32-byte hex) */
  role: Hex
  /** Address that made the change */
  sender: Address
  /** Timestamp of the change */
  timestamp: number
  /** Token address */
  token: Address
  /** Transaction hash */
  transactionHash: Hex
}
```

## Examples

### Get all role changes for a token

```ts twoslash
// @noErrors
const response = await provider.request({
  method: 'token_getRoleHistory',
  params: [{
    filters: {
      token: '0x20c0000000000000000000000000000000000001'
    },
    limit: 100,
    sort: {
      on: 'timestamp',
      order: 'desc'
    }
  }]
})
// @log: {
// @log:   nextCursor: null,
// @log:   roleChanges: [
// @log:     {
// @log:       account: '0x1234567890123456789012345678901234567890',
// @log:       blockNumber: '0x1a2b3c',
// @log:       granted: true,
// @log:       role: '0x0000000000000000000000000000000000000000000000000000000000000000',
// @log:       sender: '0xabcdef1234567890123456789012345678901234',
// @log:       timestamp: 1730010000,
// @log:       token: '0x20c0000000000000000000000000000000000001',
// @log:       transactionHash: '0xabc...'
// @log:     },
// @log:     ...
// @log:   ]
// @log: }
```

### Get role grants for a user

```ts twoslash
// @noErrors
const response = await provider.request({
  method: 'token_getRoleHistory',
  params: [{
    filters: {
      account: '0x1234567890123456789012345678901234567890',
      granted: true  
    },
    limit: 50,
    sort: {
      on: 'timestamp',
      order: 'desc'
    }
  }]
})
// @log: { nextCursor: null, roleChanges: [{ account: '0x1234567890123456789012345678901234567890',blockNumber: '0x1a2b3c',granted: true,role: '0x3e5e91220532f39bb217d204e1ddd05b24e1845ca0e450c6ba1247e80b8a088b',sender: '0xabc...',timestamp: 1730010000,token: '0x20c0000000000000000000000000000000000001',transactionHash: '0x...' }] }
```

### Track ISSUER_ROLE grants

```ts twoslash
// @noErrors
// Monitor who gets minting permissions
const response = await provider.request({
  method: 'token_getRoleHistory',
  params: [{
    filters: {
      granted: true,
      role: keccak256("ISSUER_ROLE"),  // ISSUER_ROLE
      timestamp: [1730000000, null]  // Since specific date
    },
    limit: 100,
    sort: {
      on: 'timestamp',
      order: 'desc'
    }
  }]
})
// @log: { nextCursor: null,roleChanges: [{ account: '0x5678...',blockNumber: '0x1a5000',granted: true,role: '0x3e5e91220532f39bb217d204e1ddd05b24e1845ca0e450c6ba1247e80b8a088b',sender: '0xabc...',timestamp: 1730015000,token: '0x20c0000000000000000000000000000000000002',transactionHash: '0xdef...' }] }
```

### Audit admin changes

```ts twoslash
// @noErrors
// Track DEFAULT_ADMIN_ROLE changes for compliance
const response = await provider.request({
  method: 'token_getRoleHistory',
  params: [{
    filters: {
      role: zeroAddress, // DEFAULT_ADMIN_ROLE
      token: '0x20c0000000000000000000000000000000000001'
    },
    limit: 100,
    sort: {
      on: 'blockNumber',
      order: 'asc'
    }
  }]
})
// @log: { nextCursor: null,roleChanges: [{ account: '0xfirst...',blockNumber: '0x1',granted: true,role: '0x0000000000000000000000000000000000000000000000000000000000000000',sender: '0x0000000000000000000000000000000000000000',timestamp: 1700000000,token: '0x20c0000000000000000000000000000000000001',transactionHash: '0x...' },{ account: '0xsecond...',blockNumber: '0x5a2b',granted: true,role: '0x0000000000000000000000000000000000000000000000000000000000000000',sender: '0xfirst...',timestamp: 1720000000,token: '0x20c0000000000000000000000000000000000001',transactionHash: '0x...' }] }
```

### Find all role changes by a specific admin

```ts twoslash
// @noErrors
const response = await provider.request({
  method: 'token_getRoleHistory',
  params: [{
    filters: {
      sender: '0xabcdef1234567890123456789012345678901234'  // Admin who made changes
    },
    limit: 100,
    sort: {
      on: 'timestamp',
      order: 'desc'
    }
  }]
})
// @log: { nextCursor: null,roleChanges: [{ account: '0x5678...',blockNumber: '0x1a2b3c',granted: false,role: '0x65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a',sender: '0xabcdef1234567890123456789012345678901234',timestamp: 1730010000,token: '0x20c0000000000000000000000000000000000003',transactionHash: '0x...' }] }
```
