# Roles & Permissions

TIP-20 tokens use a role-based access control system that allows you to delegate different administrative functions to different addresses. This is essential for security and operational flexibility.

## Table of Contents

- [Available Roles](#available-roles)
- [Granting Roles](#granting-roles)
- [Revoking Roles](#revoking-roles)
- [Watching Role Changes](#watching-role-changes)
- [Watching Role Admin Changes](#watching-role-admin-changes)
- [Emergency Procedures](#emergency-procedures)

## Available Roles

| Role | Hash | Purpose | Key Functions |
|------|----|---------|---------------|
| **Admin** | `bytes32(0)` | Full control | Grant/revoke all roles, set supply caps, change policies |
| **Issuer** | `keccak256("ISSUER_ROLE")` | Token supply | Mint and burn tokens |
| **Pause** | `keccak256("PAUSE_ROLE")` | Emergency control | Pause token transfers |
| **Unpause** | `keccak256("UNPAUSE_ROLE")` | Emergency control | Unpause token transfers |
| **Burn Blocked** | `keccak256("BURN_BLOCKED_ROLE")` | Compliance | Burn tokens from blocked addresses |

## Granting Roles

Grant roles to delegate specific token permissions to an address. This allows you to separate concerns: for example, your treasury can mint tokens while your security team can pause transfers.

### Example

```solidity [Example.sol]
TIP20 token = TIP20(0x20c0000000000000000000000000000000000004);

// Grant the issuer role to treasury, to mint tokens
address treasuryAddress = 0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef;
token.grantRole(keccak256("ISSUER_ROLE"), treasuryAddress);

// Grant the pause role to security, to pause transfers
address securityAddress = 0xcafecafebabedeadbeefcafebabedeadbeefcafebabe;
token.grantRole(keccak256("PAUSE_ROLE"), securityAddress);
token.grantRole(keccak256("UNPAUSE_ROLE"), securityAddress);

// Grant the burn blocked role to compliance, to burn tokens from blocked addresses
address complianceAddress = 0xbabedeadbeefcafebabedeadbeefcafebabedeadbeef;
token.grantRole(keccak256("BURN_BLOCKED_ROLE"), complianceAddress);
```

:::note
See a full [TypeScript Example](/sdk/typescript/viem/token.grantRoles)
:::

To grant a role, you must have the **admin role** for that specific role. By default, `DEFAULT_ADMIN_ROLE` (granted to the token creator) is the admin for all other roles.

### Interface

```solidity
function grantRole(
  /** Keccak256 hash of the role to grant */
  bytes32 role,
  /** Address to grant the role to */
  address account
) external;
```

### FAQ

#### How are roles identified?

Roles are identified by their `bytes32` hash:

```solidity
bytes32 ISSUER_ROLE = keccak256("ISSUER_ROLE");
// 0x114e74f6ea3bd819998f78687bfcf11b140da08e9b7d222fa9c1f1ba1f2aa122

bytes32 PAUSE_ROLE = keccak256("PAUSE_ROLE");
// 0x139c2898040ef16910dc9f44dc697df79363da767d8bc92f2e310312b816e46d
```

The special `DEFAULT_ADMIN_ROLE` is `bytes32(0)`.

#### How to delegate role administration?

Each role has an "admin role" that controls who can grant or revoke it. 
By default, all roles are administered by `DEFAULT_ADMIN_ROLE`.

You can change the role admins for more granular control.
For example: the security team (who has `PAUSE_ROLE`) can grant or revoke `PAUSE_ROLE` to other addresses.

```solidity
// Make PAUSE_ROLE self-administered
token.setRoleAdmin(PAUSE_ROLE, PAUSE_ROLE);
```

## Revoking Roles

Revoke roles to remove permissions from an address. This is useful when rotating keys, removing compromised addresses, or changing your token's administration structure.

### Example

```solidity [Example.sol]
TIP20 token = TIP20(0x20c0000000000000000000000000000000000004);

// Revoke the issuer role from old treasury // [!code focus]
address oldTreasury = 0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef; // [!code focus]
token.revokeRole(keccak256("ISSUER_ROLE"), oldTreasury); // [!code focus]

// Grant to new treasury
address newTreasury = 0xcafebabedeadbeefcafebabedeadbeefcafebabe;
token.grantRole(keccak256("ISSUER_ROLE"), newTreasury);
```

:::note
See a full [TypeScript Example](/sdk/typescript/viem/token.revokeRoles)
:::

To revoke a role, you must have the **admin role** for that specific role, just like granting.

### Interface

```solidity
function revokeRole(
  /** Keccak256 hash of the role to revoke */
  bytes32 role,
  /** Address to revoke the role from */
  address account
) external;
```

### FAQ

#### Can addresses renounce their own roles?

Yes, addresses can remove roles from themselves using `renounceRole`:

```solidity
// Renounce your own issuer role
token.renounceRole(keccak256("ISSUER_ROLE"));
```

## Watching Role Changes

Monitor when roles are granted or revoked to track permission changes and maintain audit logs.

### Example

```solidity [Example.sol]
// When you call:
token.grantRole(keccak256("ISSUER_ROLE"), treasuryAddress);

// This event is emitted:
RoleMembershipUpdated(
  role: keccak256("ISSUER_ROLE"),
  account: treasuryAddress,
  sender: msg.sender,
  hasRole: true
)
```

:::note
See a full [TypeScript Example](#TODO) for monitoring events
:::

### Interface

```solidity
event RoleMembershipUpdated(
  /** The role that was granted or revoked */
  bytes32 indexed role,
  /** The account that received or lost the role */
  address indexed account,
  /** The address that made the change */
  address indexed sender,
  /** true if granted, false if revoked */
  bool hasRole
);
```

### FAQ

#### When is this event emitted?

The `RoleMembershipUpdated` event is emitted in three cases:
- When `grantRole()` is called (with `hasRole = true`)
- When `revokeRole()` is called (with `hasRole = false`)
- When `renounceRole()` is called (with `hasRole = false` and `sender = account`)

## Watching Role Admin Changes

Monitor when a role's admin is changed to track delegation of role management authority.

### Example

```solidity [Example.sol]
// When you call:
token.setRoleAdmin(keccak256("PAUSE_ROLE"), keccak256("PAUSE_ROLE"));

// This event is emitted:
RoleAdminUpdated(
  role: keccak256("PAUSE_ROLE"),
  newAdminRole: keccak256("PAUSE_ROLE"),
  sender: msg.sender
)
```

:::note
See a full [TypeScript Example](#TODO) for monitoring events
:::

### Interface

```solidity
event RoleAdminUpdated(
  /** The role whose admin was changed */
  bytes32 indexed role,
  /** The new admin role that can now grant/revoke this role */
  bytes32 indexed newAdminRole,
  /** The address that made the change */
  address indexed sender
);
```