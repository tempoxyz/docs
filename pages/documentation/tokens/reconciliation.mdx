import { Callout } from 'vocs/components'

# Reconciliation (Memos)

TIP-20 tokens support attaching a 32-byte memo to token transfers. This is useful for including payment references, invoice IDs, order numbers, or any other metadata that helps with payment reconciliation and tracking.

## Basic Usage

The `transferWithMemo()` function works just like a standard `transfer()`, but with an additional `memo` parameter:

:::code-group
```solidity [PaymentContract.sol]
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

interface ITIP20 {
    function transferWithMemo(
        address to, 
        uint256 amount, 
        bytes32 memo
    ) external;
}

contract PaymentProcessor {
    ITIP20 public token;
    
    constructor(address _token) {
        token = ITIP20(_token);
    }
    
    function payInvoice(
        address recipient, 
        uint256 amount, 
        bytes32 invoiceId
    ) external {
        // Transfer tokens with invoice ID as memo
        token.transferWithMemo(recipient, amount, invoiceId);
    }
}
```

```ts [transferWithMemo.ts]
import { encodeFunctionData, stringToHex, pad } from 'viem'

const tokenAddress = '0x...' // Your TIP-20 token address
const recipient = '0x...'
const amount = 1000000n // 1 USDC (6 decimals)
const invoiceId = pad(stringToHex('INV-12345'), { size: 32 })

const data = encodeFunctionData({
  abi: [{
    name: 'transferWithMemo',
    type: 'function',
    inputs: [
      { name: 'to', type: 'address' },
      { name: 'amount', type: 'uint256' },
      { name: 'memo', type: 'bytes32' }
    ],
    outputs: []
  }],
  functionName: 'transferWithMemo',
  args: [recipient, amount, invoiceId]
})

const hash = await client.sendTransaction({
  to: tokenAddress,
  data
})
```
:::

<Callout type="info">
  The memo is a `bytes32` value, which means it can store 32 bytes of data. For strings shorter than 32 bytes, pad them to the right. For longer data, consider storing a hash or reference ID.
</Callout>

## Use Case: Invoice Payments

Include invoice numbers to automatically reconcile payments:

```solidity [InvoicePayments.sol]
contract InvoicePayments {
    mapping(bytes32 => bool) public paidInvoices;
    
    event InvoicePaid(bytes32 indexed invoiceId, address payer, uint256 amount);
    
    function payInvoice(
        ITIP20 token,
        address merchant,
        uint256 amount,
        bytes32 invoiceId
    ) external {
        require(!paidInvoices[invoiceId], "Invoice already paid");
        
        token.transferWithMemo(merchant, amount, invoiceId);
        paidInvoices[invoiceId] = true;
        
        emit InvoicePaid(invoiceId, msg.sender, amount);
    }
}
```

## The TransferWithMemo Event

When you call `transferWithMemo()`, the token contract emits both a standard `Transfer` event and a `TransferWithMemo` event:

```solidity [Events.sol]
event Transfer(
    address indexed from, 
    address indexed to, 
    uint256 amount
);

event TransferWithMemo(
    address indexed from,
    address indexed to,
    uint256 amount,
    bytes32 indexed memo
);
```

This allows you to filter transfers by memo in your off-chain systems, making payment reconciliation much easier.

## Additional Methods

TIP-20 provides several other functions that support memos:

### transferFromWithMemo

For transfers using allowances:

```solidity [TransferFrom.sol]
function transferFromWithMemo(
    address from,
    address to,
    uint256 amount,
    bytes32 memo
) external returns (bool);
```

This is useful when a contract needs to transfer tokens on behalf of a user.

### mintWithMemo

For minting tokens with a memo (requires `ISSUER_ROLE`):

```solidity [MintWithMemo.sol]
function mintWithMemo(
    address to,
    uint256 amount,
    bytes32 memo
) external;
```

This allows token issuers to include references when creating new tokens, useful for tracking mint reasons or batch IDs.

### burnWithMemo

For burning tokens with a memo:

```solidity [BurnWithMemo.sol]
function burnWithMemo(
    uint256 amount,
    bytes32 memo
) external;
```

This lets users include a reference when burning their own tokens, useful for redemption tracking or accounting purposes.

---

For more information on TIP-20 tokens, see:
- [Token Overview](/documentation/tokens)
- [Creating Tokens](/documentation/tokens/creating-tokens)
- [TIP-20 Specification](/protocol/tokens/tip-20)