import { Callout } from 'vocs/components'

# Passkey Authentication

Sign transactions with Face ID, Touch ID, or Windows Hello. Passkeys use P256 cryptography natively supported by Tempo.

## Deriving an Address from a Passkey

Passkey accounts use P256 public keys. The address is derived from the public key coordinates:

```solidity
function deriveAddressFromP256(bytes32 pubKeyX, bytes32 pubKeyY)
    public
    pure
    returns (address)
{
    bytes32 hash = keccak256(abi.encodePacked(pubKeyX, pubKeyY));
    return address(uint160(uint256(hash)));
}
```

**Steps:**
1. Generate a P256 keypair using your device's passkey API (WebAuthn)
2. Extract the public key coordinates (x, y)
3. Derive the address using the function above

## P256 Signature Format

P256 signatures are 130 bytes total with the following structure:

```solidity
struct P256Signature {
    byte typeId;         // 0x01 type identifier
    bytes32 r;           // Signature r value
    bytes32 s;           // Signature s value
    bytes32 pubKeyX;     // Public key X coordinate
    bytes32 pubKeyY;     // Public key Y coordinate
    bool preHash;        // Whether digest needs SHA256 before verification
}
```

The protocol detects P256 signatures by the `0x01` type identifier prefix and 130-byte total length.

## Signing a Transaction

```solidity
// 1. Create transaction hash
bytes32 txHash = keccak256(encodedTransaction);

// 2. Sign with your device's passkey (via WebAuthn API)
// This returns r, s signature values
(bytes32 r, bytes32 s) = signWithPasskey(txHash);

// 3. Construct the 130-byte signature
bytes memory signature = abi.encodePacked(
    bytes1(0x01),  // P256 type identifier
    r,
    s,
    pubKeyX,
    pubKeyY,
    false  // preHash flag - set to true if using Web Crypto API
);

// 4. Submit transaction with P256 signature
submitTransaction(transaction, signature);
```

<Callout type="note">
  Set `preHash` to `true` if your P256 implementation (like Web Crypto API) requires the message digest to be SHA256 hashed before signing. Tempo will apply SHA256 to the digest before verification.
</Callout>

## WebAuthn Signatures

For WebAuthn (variable length, max 2KB), the signature includes authenticator data:

```solidity
struct WebAuthnSignature {
    byte typeId;                 // 0x02 type identifier
    bytes verificationData;      // Variable length authenticator data
    bytes32 r;
    bytes32 s;
    bytes32 pubKeyX;
    bytes32 pubKeyY;
}
```

The protocol detects WebAuthn signatures by the `0x02` type identifier prefix. Total length is variable (minimum 129 bytes, maximum 2049 bytes).

## Gas Costs

P256 signature verification adds approximately 5,000 gas to the base transaction cost. WebAuthn signatures cost additional gas based on authenticator data size (charged using calldata gas schedule: 16 gas per non-zero byte, 4 gas per zero byte).

For complete technical specifications, see the [Account Abstraction](/protocol/transactions/account-abstraction) specification.
