import { Callout } from 'vocs/components'

# Fee Token Preferences Cascade

The fee token used for a transaction is determined by the following hierarchy (in order of precedence).  If none of these preferences are set or applicable, the transaction will fail.

::::steps
### Transaction-level
If an AA transaction specifies the `feeToken` field, that token is used. See the [transaction fee token](/documentation/transactions/transaction-fee-tokens) docs for how to specify a transaction fee token.

### Account-level
Users can specify their own default fee token preference and that is used if no transaction-level fee token is specified. A non-AA transaction (without the `feeToken` field) that calls `setUserToken` will use the newly set token for that transaction only.

### Token-level
Transactions where the top-level call is to a USD TIP-20 token use that token for fees. For AA transactions, if all calls are to the same USD TIP-20 token, that token is used.

### Validator-level
The validator's preferred token is used as a fallback.
::::

## User Defaults

You can set a default fee token preference for your account. After setting your default fee token, the system will automatically:
1. Check if you have sufficient balance in the specified fee token
2. Deduct the appropriate fee amount from that token
3. Either pay the validator directly (if they prefer the same token) or convert it through a built in Fee AMM that will find liquidity for your preferred fee-paying stablecoin.


### Setting User Fee Token Preference

```solidity
// Set your preferred fee token
feeManager.setUserToken(preferredTokenAddress);
```

After setting your default fee token, all future transactions will use that token for fees by default unless overridden by transaction-level preferences. When no fee token is specified in a transaction, it will use your default setting. This is a one-time setup, so you don't need to specify the fee token in every transaction.


## Validator Preferences

Validators can set a default fee token preference that determines which stablecoin they receive for transaction fees. When users pay in different tokens, the Fee AMM automatically converts to the validator's preferred token.


### Setting Your Preference

```solidity
// Set your preferred fee token
feeManager.setValidatorToken(preferredTokenAddress);
```

After setting your validator token preference, all fees collected in blocks you propose will be automatically converted to your chosen token (if needed) and transferred to your account.


### Removing Your Preference

To remove your validator token preference, set it to the zero address:

```solidity
// Remove validator token preference
feeManager.setValidatorToken(address(0));
```
