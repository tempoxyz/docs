import * as Demo from '../../../components/guides/Demo.tsx'
import LucideCoins from '~icons/lucide/coins'
import * as Card from '../../../components/Card.tsx'

# Pay Fees in Any Stablecoin

Configure users to pay transaction fees in any supported stablecoin. Tempo's flexible fee system allows users to pay fees with the same token they're using, eliminating the need to hold a separate gas token.

## Demo

By the end of this guide you will be able to pay fees in any stablecoin on Tempo.

<Demo.Container name="Pay Fees in Any Stablecoin" footerVariant="source" src="tempoxyz/tempo-ts/tree/main/examples/payments">
  <Demo.Connect stepNumber={1} />
  <Demo.AddFunds stepNumber={2} />
  <Demo.PayWithFeeToken stepNumber={3} feeToken={Demo.betaUsd} last />
</Demo.Container>

## Steps

::::steps

### Set up Wagmi & integrate accounts

Ensure that you have set up your project with Wagmi and integrated accounts by following either of the guides:

- [Embed Passkey accounts](/guide/use-accounts/embed-passkeys)
- [Connect to wallets](/guide/use-accounts/connect-to-wallets)

### Add testnet funds¹

Before you can pay fees in a token of your choice, you need to fund your account. In this guide you will be sending `AlphaUSD` (`0x20c000…0001`) and paying fees in `BetaUSD` (`0x20c000…0002`).

The built-in Tempo testnet faucet funds accounts with `AlphaUSD` and `BetaUSD`.

<Demo.Container name="Add Funds" footerVariant="balances" showBadge={false} tokens={[Demo.alphaUsd, Demo.betaUsd]}>
  <Demo.AddFunds stepNumber={1} last />
</Demo.Container>

:::code-group

```tsx twoslash [AddFunds.ts]
// @noErrors
import { Hooks } from 'tempo.ts/wagmi'
import { useAccount } from 'wagmi'

export function AddFunds() {
  const { address } = useAccount()
  const addFunds = Hooks.faucet.useFund()

  return (
    <button onClick={() => addFunds.mutate({ account: address })}>
      Add Funds
    </button>
  )
}
```

```tsx twoslash [config.ts] filename="config.ts"
// @noErrors
import { createConfig, http } from 'wagmi'
import { tempo } from 'tempo.ts/chains'
import { webAuthn } from 'tempo.ts/wagmi'

export const config = createConfig({
  chains: [tempo({ feeToken: '0x20c0000000000000000000000000000000000001' })],
  connectors: [webAuthn()],
  transports: {
    [tempo.id]: http(),
  },
})
```

:::

:::warning
¹ It is important to note that the `addFunds` Hook only works on testnets as a convenience feature to get
started quickly. For production, you will need to onramp & fund your account manually.
:::

### Add fee token selector

Now that you have `AlphaUSD` to send and `BetaUSD` to pay fees with, you can add a new selector component to allow users to select the fee token.

<Demo.Container name="Select Fee Token" footerVariant="balances" showBadge={false} tokens={[Demo.alphaUsd, Demo.betaUsd]}>
  <Demo.Connect stepNumber={1} />
  <Demo.SelectFeeToken stepNumber={2} last />
</Demo.Container>

:::code-group

```tsx twoslash [PayWithFeeToken.tsx]
import React from 'react'

// @noErrors
export function PayWithFeeToken() {
  const [feeToken, setFeeToken] = React.useState<string>('0x20c0000000000000000000000000000000000001')

  return (
    <div>
      <select name="feeToken" onChange={(e) => setFeeToken(e.target.value)}>
        <option value="0x20c0000000000000000000000000000000000001">AlphaUSD</option>
        <option value="0x20c0000000000000000000000000000000000002">BetaUSD</option>
      </select>
    </div>
  )
}
```

```tsx twoslash [config.ts] filename="config.ts"
// @noErrors
import { createConfig, http } from 'wagmi'
import { tempo } from 'tempo.ts/chains'
import { webAuthn } from 'tempo.ts/wagmi'

export const config = createConfig({
  chains: [tempo({ feeToken: '0x20c0000000000000000000000000000000000001' })],
  connectors: [webAuthn()],
  transports: {
    [tempo.id]: http(),
  },
})
```

:::

### Add pay with fee token logic

Now that you have a selector for the fee token, you can add the logic to send a payment with the selected fee token.

After this step, your users can send payments with a specified fee token by clicking the "Send" button!

<Demo.Container name="Pay Fees in Any Stablecoin" footerVariant="source" src="tempoxyz/tempo-ts/tree/main/examples/payments">
  <Demo.AddFunds stepNumber={1} />
  <Demo.PayWithFeeToken stepNumber={2} last />
</Demo.Container>

:::code-group

```tsx twoslash [PayWithFeeToken.tsx]
import React from 'react'
import { Hooks } from 'tempo.ts/wagmi' // [!code ++]
import { parseUnits } from 'viem' // [!code ++]

// @noErrors
export function PayWithFeeToken() {
  const [feeToken, setFeeToken] = React.useState<string>('0x20c0000000000000000000000000000000000001')
  const sendPayment = Hooks.token.useTransferSync() // [!code ++]
  const { data: metadata } = Hooks.token.useGetMetadata({ // [!code ++]
    token: alphaUsd, // [!code ++]
  }) // [!code ++]

  return (
    <div>
      <select name="feeToken" onChange={(e) => setFeeToken(e.target.value)}>
        <option value="0x20c0000000000000000000000000000000000001">AlphaUSD</option>
        <option value="0x20c0000000000000000000000000000000000002">BetaUSD</option>
      </select>
      <button // [!code ++]
        disabled={sendPayment.isPending} // [!code ++]
        type="button" // [!code ++]
        onClick={() => // [!code ++]
          sendPayment.mutate({ // [!code ++]
            amount: parseUnits('100', metadata.data?.decimals ?? 6), // [!code ++]
            to: recipient, // [!code ++]
            token: alphaUsd, // [!code ++]
            feeToken: feeToken, // [!code ++]
          }) // [!code ++]
        } // [!code ++]
      > {/* // [!code ++] */}
        Send {/* // [!code ++] */}
      </button> {/* // [!code ++] */}
    </div>
  )
}
```

```tsx twoslash [config.ts] filename="config.ts"
// @noErrors
import { createConfig, http } from 'wagmi'
import { tempo } from 'tempo.ts/chains'
import { webAuthn } from 'tempo.ts/wagmi'

export const config = createConfig({
  chains: [tempo({ feeToken: '0x20c0000000000000000000000000000000000001' })],
  connectors: [webAuthn()],
  transports: {
    [tempo.id]: http(),
  },
})
```
:::

### Display a receipt

Now that users can send payments with a specified fee token, you can link to the transaction receipt.

:::code-group

```tsx twoslash [PayWithFeeToken.tsx]
import React from 'react'
import { Hooks } from 'tempo.ts/wagmi' // [!code ++]
import { parseUnits } from 'viem' // [!code ++]

// @noErrors
export function PayWithFeeToken() {
  const [feeToken, setFeeToken] = React.useState<string>('0x20c0000000000000000000000000000000000001')
  const sendPayment = Hooks.token.useTransferSync()
  const { data: metadata } = Hooks.token.useGetMetadata({
    token: alphaUsd,
  })

  return (
    <div>
      <select name="feeToken" onChange={(e) => setFeeToken(e.target.value)}>
        <option value="0x20c0000000000000000000000000000000000001">AlphaUSD</option>
        <option value="0x20c0000000000000000000000000000000000002">BetaUSD</option>
      </select>
      <button
        disabled={sendPayment.isPending}
        type="button"
        onClick={() =>
          sendPayment.mutate({
            amount: parseUnits('100', metadata.data?.decimals ?? 6),
            to: recipient,
            token: alphaUsd,
            feeToken: feeToken,
          })
        }
      >
        Send
      </button>

      {sendPayment.data && ( // [!code ++]
        <a // [!code ++]
          href={`https://explore.tempo.xyz/tx/${sendPayment.data.receipt.transactionHash}`} // [!code ++]
          target="_blank" // [!code ++]
          rel="noopener noreferrer" // [!code ++]
        > {/* // [!code ++] */}
          View receipt {/* // [!code ++] */}
        </a> // [!code ++]
      )} // [!code ++]
    </div>
  )
}
```

```tsx twoslash [config.ts] filename="config.ts"
// @noErrors
import { createConfig, http } from 'wagmi'
import { tempo } from 'tempo.ts/chains'
import { webAuthn } from 'tempo.ts/wagmi'

export const config = createConfig({
  chains: [tempo({ feeToken: '0x20c0000000000000000000000000000000000001' })],
  connectors: [webAuthn()],
  transports: {
    [tempo.id]: http(),
  },
})
```
:::

### Next steps

Now that you have made a payment using a desired fee token, you can:
- Follow a guide on how to [sponsor user fees](/guide/payments/sponsor-user-fees) to enable gasless transactions
- Learn more about [transaction fees](/documentation/protocol/fees)

::::

## Learning Resources

<Card.Container>
  <Card.Link
    description="Learn more about transaction fees on Tempo"
    href="/documentation/protocol/fees"
    icon={LucideCoins}
    title="Transaction Fees"
  />
</Card.Container>