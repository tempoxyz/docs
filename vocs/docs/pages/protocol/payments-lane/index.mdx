#  Payments Lane

Tempo reserves a portion of the blockspace for payments. This is done by the validator as part of the consensus protocol, and is used to ensure that payments are not starved by other transaction types. This is implemented in protocol as follows:

## Custom Header Field

The block header contains a custom field `generalGasLimit`. This is the total amount of gas that can be used for general (non-payment) transactions in the block. Other fields in the header are standard. 

## Classifiying a Payment Transaction 

Transactions are classified as payments/ non-payments as a pure function of the transaction bytes (no state access). Determined by a versioned, pure classifier `isPaymentTx(tx) -> bool`.  
- **Non-payment transaction:** `!isPaymentTx(tx)`.  

For version 1 of the classifier, a transaction is classified as a payment transaction if it is a transfer of a TIP-20 token: i.e., the `to` address is a TIP-20 token address . Later forks may change the classifier by bumping `ClassifierID`.

## Block Validity Rules

The block is valid if the following conditions are met:

1. The total gas used in the block is less than or equal to the `gasLimit` field in the header, as is standard.
2. The total gas used for general transactions (i.e., `!isPaymentTx(tx)`) is less than or equal to `generalGasLimit`: formally, the block validity checker keeps track of remaining `generalGasLeft`.  As it goes through the block each non-payment tx must have a `gasLimit` less than or equal to `generalGasLeft` before execution. Then after commit, `generalGasLeft` is decremented by actual `gasUsed`.

