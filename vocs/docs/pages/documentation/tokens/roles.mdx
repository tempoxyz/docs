# Roles & Permissions

TIP-20 tokens use a role-based access control system that allows you to delegate different administrative functions to different addresses. This is essential for security and operational flexibility.

## Available Roles

| Role | Purpose | Key Functions |
|------|---------|---------------|
| `defaultAdmin` | Full control | Grant/revoke all roles, set supply caps, change policies |
| `issuer` | Token supply | Mint and burn tokens |
| `pause` | Emergency control | Pause token transfers |
| `unpause` | Emergency control | Unpause token transfers |
| `burnBlocked` | Compliance | Burn tokens from blocked addresses |

## Granting Roles

### Grant Issuer Role

```ts
// [!include ~/snippets/setup.ts:setup] 

const treasuryAddress = '0xdeadbeefcafebabedeadbeefcafebabedeadbeef' // [!code focus]

const hash = await client.token.grantRoles({ // [!code focus]
  roles: ['issuer'], // [!code focus]
  to: treasuryAddress, // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```

### Grant Pause Role

```ts
const securityTeamAddress = '0xdeadbeefcafebabedeadbeefcafebabedeadbeef' // [!code focus]

const hash = await client.token.grantRoles({ // [!code focus]
  roles: ['pause'], // [!code focus]
  to: securityTeamAddress, // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```

### Grant Multiple Roles

```ts
const securityTeamAddress = '0xdeadbeefcafebabedeadbeefcafebabedeadbeef' // [!code focus]

const hash = await client.token.grantRoles({ // [!code focus]
  roles: ['issuer', 'pause', 'unpause'], // [!code focus]
  to: securityTeamAddress, // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```

## Revoking Roles

```ts
const treasuryAddress = '0xdeadbeefcafebabedeadbeefcafebabedeadbeef' // [!code focus]

// Remove minting rights from old treasury // [!code focus]
const hash = await client.token.revokeRoles({ // [!code focus]
  from: treasuryAddress, // [!code focus]
  roles: ['issuer'], // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```

### Separate Concerns

Don't give all roles to one address:

- **Treasury team**: `issuer` only
- **Security team**: `pause` and `unpause`
- **Compliance team**: `burnBlocked`
- **Governance**: `defaultAdmin`

{/* ### Regular Audits

Periodically review who has what roles:

```javascript
// Check all roles for an address
const roles = [
  'DEFAULT_ADMIN_ROLE',
  'ISSUER_ROLE', 
  'PAUSE_ROLE',
  'UNPAUSE_ROLE',
  'BURN_BLOCKED_ROLE'
]

for (const roleName of roles) {
  const role = '0x' + keccak256(roleName).slice(2)
  const hasRole = await token.read.hasRole([role, addressToCheck])
  console.log(`${roleName}: ${hasRole}`)
}
``` */}

## Role Events

The token emits events when roles are granted or revoked:

```ts
await client.token.watchRole({ // [!code focus]
  onRoleUpdated: (args) => { // [!code focus]
    console.log(`Role ${args.role} ${args.type === 'granted' ? 'granted to' : 'revoked from'} ${args.account}`) // [!code focus]
  }, // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```

{/* ```javascript
// Listen for role changes
token.watchEvent.RoleMembershipUpdated({
  onLogs: (logs) => {
    logs.forEach((log) => {
      console.log(`Role ${log.args.role} ${log.args.hasRole ? 'granted to' : 'revoked from'} ${log.args.account}`)
    })
  }
})
``` */}

## Emergency Procedures

### Immediate Pause

If you have `pause`, you can immediately stop all transfers:

```ts
const hash = await client.token.pause({ // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```


### Remove Compromised Roles

If an address is compromised, immediately revoke all roles:

```ts
const compromisedAddress = '0xdeadbeefcafebabedeadbeefcafebabedeadbeef' // [!code focus]

const roles = [
  'DEFAULT_ADMIN_ROLE',
  'ISSUER_ROLE', 
  'PAUSE_ROLE',
  'UNPAUSE_ROLE',
  'BURN_BLOCKED_ROLE'
]

for (const roleName of roles) { // [!code focus]
  const role = '0x' + keccak256(roleName).slice(2) // [!code focus]
  const hash = await client.token.revokeRoles({ // [!code focus]
    role: role, // [!code focus]
    account: compromisedAddress, // [!code focus]
  }) // [!code focus]
  console.log(`${roleName} revoke hash: ${hash}`) // [!code focus]

  const hasRole = await token.read.hasRole([role, addressToCheck]) // [!code focus]

  console.log(`${roleName}: ${hasRole}`) // [!code focus]
} // [!code focus]
```

For detailed technical specifications, see the [TIP-20 Protocol Reference](/protocol/tokens/tip-20).
