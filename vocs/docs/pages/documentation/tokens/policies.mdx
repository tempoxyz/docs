# Token Policies

Token policies let you control who can transfer your tokens. You can create whitelist policies (only approved addresses can transfer) or blacklist policies (blocked addresses cannot transfer). This is useful for compliance, KYC requirements, or security.

## Creating Policies

### Create a Whitelist Policy

```ts
// [!include ~/snippets/setup.ts:setup] 

const { hash, policyId } = await client.policy.create({  // [!code focus]
  type: 'whitelist', // [!code focus]
}) // [!code focus]
```

### Create a Blacklist Policy

```ts
const { hash, policyId } = await client.policy.create({  // [!code focus]
  type: 'blacklist', // [!code focus]
}) // [!code focus]
```

### Create Policy with Initial Addresses

```ts
const { hash, policyId } = await client.policy.create({  // [!code focus]
  type: 'whitelist', // [!code focus]
  accounts: [user1Address, user2Address, user3Address], // [!code focus]
}) // [!code focus]
```

## Managing Whitelist Policies

### Add Addresses to Whitelist

```ts
const { hash, policyId } = await client.policy.modifyWhitelist({  // [!code focus]
  address: '0xdeadbeefcafebabedeadbeefcafebabedeadbeef', // [!code focus]
  allowed: true, // [!code focus]
  policyId, // [!code focus]
}) // [!code focus]
```

### Remove Addresses from Whitelist

```ts
const { hash, policyId } = await client.policy.modifyWhitelist({  // [!code focus]
  address: '0xdeadbeefcafebabedeadbeefcafebabedeadbeef', // [!code focus]
  allowed: false, // [!code focus]
  policyId, // [!code focus]
}) // [!code focus]
```

## Managing Blacklist Policies

### Add Addresses to Blacklist

```ts
const { hash, policyId } = await client.policy.modifyBlacklist({  // [!code focus]
  address: '0xdeadbeefcafebabedeadbeefcafebabedeadbeef', // [!code focus]
  restricted: true, // [!code focus]
  policyId, // [!code focus]
}) // [!code focus]
```

### Remove Addresses from Blacklist

```ts
const { hash, policyId } = await client.policy.modifyBlacklist({  // [!code focus]
  address: '0xdeadbeefcafebabedeadbeefcafebabedeadbeef', // [!code focus]
  restricted: false, // [!code focus]
  policyId, // [!code focus]
}) // [!code focus]
```

## Applying Policies to Tokens

### Set Transfer Policy

```ts
const { hash, policyId } = await client.token.changeTransferPolicy({  // [!code focus]
  policyId: 1n, // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```

### Check Current Policy

```ts
const { transferPolicy } = await client.token.getMetadata({  // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```

## Special Policies

### Always Allow (Default)

```ts
const { hash, policyId } = await client.token.changeTransferPolicy({  // [!code focus]
  policyId: 1n, // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```

### Always Reject (Emergency Stop)

```ts
const { hash, policyId } = await client.token.changeTransferPolicy({  // [!code focus]
  policyId: 0n, // [!code focus]
  token: '0x20c0000000000000000000000000000000000004', // [!code focus]
}) // [!code focus]
```

## Common Use Cases

### KYC Whitelist

```ts
const complianceAdminAddress = '0xdeadbeefcafebabedeadbeefcafebabedeadbeef' // [!code focus]
const token = '0x20c0000000000000000000000000000000000004' // [!code focus]

// 1. Create whitelist policy // [!code focus]
const { hash, policyId } = await client.policy.create({  // [!code focus]
  admin: complianceAdminAddress, // [!code focus]
  type: 'whitelist', // [!code focus]
  token, // [!code focus]
}) // [!code focus]
await client.waitForTransactionReceipt({ hash }) // [!code focus]

// 2. Add KYC'd users // [!code focus]
const kycUsers = [user1Address, user2Address, user3Address]
for (const user of kycUsers) {
  await client.policy.modifyWhitelist({  // [!code focus]
    address: user, // [!code focus]
    allowed: true, // [!code focus]
    policyId, // [!code focus]
  }) // [!code focus]
}

// 3. Apply to token // [!code focus]
await client.token.changeTransferPolicy({  // [!code focus]
  policyId, // [!code focus]
  token, // [!code focus]
}) // [!code focus]

console.log(`KYC whitelist policy ${policyId} applied to token`)
```

### Security Blacklist

```ts
const securityAdminAddress = '0xdeadbeefcafebabedeadbeefcafebabedeadbeef' // [!code focus]
const token = '0x20c0000000000000000000000000000000000004' // [!code focus]

// 1. Create blacklist policy // [!code focus]
const { hash, policyId } = await client.policy.create({  // [!code focus]
  admin: securityAdminAddress, // [!code focus]
  type: 'blacklist', // [!code focus]
  token, // [!code focus]
}) // [!code focus]
await client.waitForTransactionReceipt({ hash }) // [!code focus]

// 2. Add blocked addresses // [!code focus]
const blockedAddresses = [hacker1, hacker2, suspiciousContract]
for (const user of blockedAddresses) {
  await client.policy.modifyBlacklist({  // [!code focus]
    address: user, // [!code focus]
    restricted: true, // [!code focus]
    policyId, // [!code focus]
  }) // [!code focus]
}

// 3. Apply to token // [!code focus]
await client.token.changeTransferPolicy({  // [!code focus]
  policyId, // [!code focus]
  token, // [!code focus]
}) // [!code focus]

console.log(`Security blacklist policy ${policyId} applied to token`)
```

## Policy Administration

### Transfer Policy Admin

```ts
const adminAddress = '0xdeadbeefcafebabedeadbeefcafebabedeadbeef' // [!code focus]

const { hash, policyId } = await client.policy.setAdmin({  // [!code focus]
  policyId: 123n, // [!code focus]
  admin: adminAddress, // [!code focus]
}) // [!code focus]
```

### Check Authorization

```ts
const userAddress = '0xdeadbeefcafebabedeadbeefcafebabedeadbeef' // [!code focus]

const { hash, policyId } = await client.policy.isAuthorized({  // [!code focus]
  policyId: 123n, // [!code focus]
  user: userAddress, // [!code focus]
}) // [!code focus]
```

## Monitoring Policy Changes

```ts
// Listen for whitelist updates // [!code focus]
await client.policy.watchWhitelistUpdated({  // [!code focus]
  policyId: 123n, // [!code focus]
  onWhitelistUpdated: (args) => {  // [!code focus]
    console.log(`Policy ${args.policyId}: ${args.account} ${args.allowed ? 'added to' : 'removed from'} whitelist`)  // [!code focus]
  }  // [!code focus]
})  // [!code focus]

// Listen for blacklist updates // [!code focus]
await client.policy.watchBlacklistUpdated({  // [!code focus]
  policyId: 123n, // [!code focus]
  onBlacklistUpdated: (args) => {  // [!code focus]
    console.log(`Policy ${args.policyId}: ${args.account} ${args.restricted ? 'added to' : 'removed from'} blacklist`)  // [!code focus]
  }  // [!code focus]
})  // [!code focus]
```

For detailed technical specifications, see the [TIP-403 Protocol Reference](/protocol/tokens/tip-403).