# Adding Liquidity to the Fee AMM

The Fee AMM is a specialized Automated Market Maker designed to facilitate gas fee payments in user-preferred stablecoins. By providing liquidity to the Fee AMM, you help ensure smooth fee conversions while earning rewards from trading activity. This system addresses the [motivation](/protocol/transactions/fee-amm#motivation) of reducing friction for users who prefer to transact in stablecoins rather than native tokens.

## Overview

The Fee AMM operates with two distinct swap mechanisms:

- **[Fee Swaps](/protocol/transactions/fee-amm#fee-swaps)**: Fixed-rate swaps at 99.70% for gas fee conversions (protocol-only)
- **[Rebalancing Swaps](/protocol/transactions/fee-amm#rebalancing-swaps)**: Variable-rate swaps to restore pool balance (public)

 Liquidity providers earn fees from both types of swaps while helping maintain the pool's balance for efficient fee conversions. The system is designed with [MEV mitigation strategies](/protocol/transactions/fee-amm#mev-mitigation-strategy) to prevent spam and ensure fair operation.

## Contract Interface

The Fee AMM is implemented through the `StableAMM` contract. For complete technical specifications including all functions, events, and data structures, see the [Fee AMM Protocol Specification](/protocol/transactions/fee-amm).

Key functions for liquidity provision:
- [`mint()`](/protocol/transactions/fee-amm#liquidity-provision) - Add liquidity to a pool
- [`burn()`](/protocol/transactions/fee-amm#liquidity-provision) - Remove liquidity from a pool  
- [`getPool()`](/protocol/transactions/fee-amm#pool-structure) - Get current pool reserves
- [`liquidityBalances()`](/protocol/transactions/fee-amm#liquidity-provision) - Get LP token balance

## Adding Liquidity

### Prerequisites

1. **USD Stablecoins**: Only USD-denominated stablecoins are supported
2. **Token Approval**: Approve the AMM contract to spend your tokens
3. **Sufficient Balance**: Ensure you have enough of both tokens
4. **Pool Exists**: The token pair must already exist in the AMM

### Basic Example

First, approve both tokens for the AMM contract to spend:

:::code-group
```ts [approve.ts]
import { parseUnits } from 'viem'

const alphaUSDAddress = '0x20c0000000000000000000000000000000000000'
const betaUSDAddress = '0x20c0000000000000000000000000000000000001'

await client.token.approve({ // [!code focus]
  amount: parseUnits('1000', 6), // [!code focus]
  spender: ammAddress, // [!code focus]
  token: alphaUSDAddress, // [!code focus]
}) // [!code focus]

await client.token.approve({ // [!code focus]
  amount: parseUnits('1000', 6), // [!code focus]
  spender: ammAddress, // [!code focus]
  token: betaUSDAddress, // [!code focus]
}) // [!code focus]
```

```ts [viem.config.ts]
// [!include ~/snippets/setup.ts:setup] 
```
:::

Then call [`mint()`](/protocol/transactions/fee-amm#liquidity-provision) with both token amounts. The function returns the LP tokens minted:

:::code-group
```ts [mint.ts]
await client.amm.mint({ // [!code focus]
  to: '0xdeadbeefcafebabedeadbeefcafebabedeadbeef', // [!code focus]
  userToken: { // [!code focus]
    address: alphaUSDAddress, // [!code focus]
    amount: parseUnits('1000', 6), // [!code focus]
  }, // [!code focus]
  validatorToken: { // [!code focus]
    address: betaUSDAddress, // [!code focus]
    amount: parseUnits('1000', 6), // [!code focus]
  }, // [!code focus]
}) // [!code focus]
```

```ts [viem.config.ts]
// [!include ~/snippets/setup.ts:setup] 
```
:::

For the initial liquidity provision, you can provide the entire amount in the validatorToken. 

As fees are paid in the user token, the balance changes, but the AMM is designed to incentivize arbitrageurs to rebalance it back toward holding 100% of the validator token, as long as the price of the user token is within 0.15% of the price of the validator token.

## Removing Liquidity

### Basic Removal

To remove your liquidity, you first must find out how much LP tokens you own by calling `getLiquidityBalance()`:

:::code-group
```ts [removeLiquidity.ts]
const alphaUSDAddress = '0x20c0000000000000000000000000000000000000'
const betaUSDAddress = '0x20c0000000000000000000000000000000000001'

const poolId = await client.amm.getPoolId({
  userToken: alphaUSDAddress,
  validatorToken: betaUSDAddress,
})

const balance = await client.amm.getLiquidityBalance({
  poolId,
  address: '0x...',
})
```

```ts [viem.config.ts]
// [!include ~/snippets/setup.ts:setup] 
```
:::

Then, call `burn()` to burn your LP tokens and get back the underlying tokens. 

Note that withdrawals may be blocked if they would prevent pending fee swaps:

:::code-group
```ts [burn.ts]
await client.amm.burn({ // [!code focus]
  to: '0xdeadbeefcafebabedeadbeefcafebabedeadbeef', // [!code focus]
  userToken: alphaUSDAddress // [!code focus]
  validatorToken: betaUSDAddress // [!code focus]
  liquidity: balance, // [!code focus]
  amount: parseUnits('1000', 6), // [!code focus]
}) // [!code focus]
```

```ts [viem.config.ts]
// [!include ~/snippets/setup.ts:setup] 
```
:::

## LP Token Management

### Check Your LP Tokens

Check your LP token balance for a specific pool:

:::code-group
```ts [liquidity.ts]
const alphaUSDAddress = '0x20c0000000000000000000000000000000000000'
const betaUSDAddress = '0x20c0000000000000000000000000000000000001'

const poolId = await client.amm.getPoolId({
  userToken: alphaUSDAddress,
  validatorToken: betaUSDAddress,
})

const balance = await client.amm.getLiquidityBalance({
  poolId,
  address: '0x...',
})
```

```ts [viem.config.ts]
// [!include ~/snippets/setup.ts:setup] 
```
:::

### Check Pool Reserves

Check current pool reserves:

:::code-group
```ts [poolReserves.ts]
const alphaUSDAddress = '0x20c0000000000000000000000000000000000000'
const betaUSDAddress = '0x20c0000000000000000000000000000000000001'

const pool = await client.amm.getPool({
  userToken: alphaUSDAddress,
  validatorToken: betaUSDAddress,
})

const alphaUSDReserve = pool.reserveUserToken
const betaUSDReserve = pool.reserveValidatorToken
```

```ts [viem.config.ts]
// [!include ~/snippets/setup.ts:setup] 
```
:::

## Earning Rewards

As a liquidity provider, you earn fees from both types of swaps in the Fee AMM:

- **[Fee Swaps](/protocol/transactions/fee-amm#fee-swaps)**: 0.3% fee on all gas fee conversions (fixed rate at m=0.9970)
- **[Rebalancing Swaps](/protocol/transactions/fee-amm#rebalancing-swaps)**: Variable fees from arbitrage activity

Fees are automatically added to the pool reserves, increasing the value of your LP tokens over time. The system processes fee swaps at the end of each block, ensuring consistent fee distribution.


For complete technical specifications, contract interfaces, and implementation details, see the [Fee AMM Protocol Specification](/protocol/transactions/fee-amm).

